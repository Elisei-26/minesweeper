<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
    <title>Minesweeper</title>
    <style type="text/css">
      table {
        width: 700px;
        border: 4px solid; 
      }
      tr {
        border: 4px solid;
      }
      td {
        border: 4px solid;
        height: 50px;
      }
      button {
        height: 50px;
        width: 50px;
      }
    </style>
  </head>
  <body>
    <center>
      <div class="container"><font size="10"><p></p></font></div>
      <div>
        <button type="button" class="btn btn-outline-dark btn-primary" onclick="return restart();"><i class="las la-redo-alt"></i></button>
      </div>
      <div class="container"><font size="10"><p></p></font></div>
      <table id="table"></table>
      <div class="container">
        <font size="6"><p id="message"></p></font>
      </div>
    </center>

    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js" integrity="sha384-lpyLfhYuitXl2zRZ5Bn2fqnhNAKOAaM/0Kr9laMspuaMiZfGmfwRNFh8HlMy49eQ" crossorigin="anonymous">
    </script>

    <script type="text/javascript">
      const table = new Array(16).fill(0).map(() => new Array(16).fill(0));
      for (var i = 0; i < 16; ++i) {
        for (var j = 0; j < 16; ++j) {
          if (i == 0 || j == 0 || i == 15 || j == 15) {
            table[i][j] = 1;
          } else {
            table[i][j] = 0;
          }
        }
      }
      var nrBombs = 30, x, y;
      while (nrBombs > 0) {
        x = Math.floor(Math.random() * Math.floor(14));
        y = Math.floor(Math.random() * Math.floor(14));
        if (table[x][y] == 0) {
          table[x][y] = 4;
          --nrBombs;
        }
      }
      for (var m = 1; m < 15; ++m) {
        $('#table').append('<tr></tr>');
        for (var n = 1; n < 15; ++n) {
          $('#table').append('<td align="center" valign="middle"><button type="button" class="btn btn-outline-dark btn-primary" id="' + m + " " + n + '"  onmousedown="WhichButton(event, id);"><font size="5">‚õù</font></button></td>');
        }
      }
      var gameStatus = 0;

      function WhichButton(event, id) {
        if (gameStatus == '0') {
          var length = id.length;
          var x = 0, y = 0;
          for (var i = 0; i < length; ++i) {
            if (id[i] !== ' ') {
              y = ((y * 10) + (id[i] - '0'));
            } else {
              x = y;
              y = 0;
            }
          }
          if (event.buttons == '2' && table[x][y] != '1') {
            document.getElementById(id).innerHTML = ('üö©');
          } else if (event.buttons == '4' && table[x][y] != '1') {
            document.getElementById(id).innerHTML = ('?');
          } else {
            if (table[x][y] == '4') {
              for (var i = 0; i < 16; ++i) {
                for (var j = 0; j < 16; ++j) {
                  if (table[i][j] == '4') {
                    document.getElementById(i + " " + j).style.backgroundColor = 'red';
                    document.getElementById(i + " " + j).innerHTML = ('üí£');
                  }
                }
              }
              ++gameStatus;
              document.getElementById("message").innerHTML = ('You lost! Click on RESTART to try again!');
            } else {
              return leftClick(x, y);
            }
          }
        } else {
          document.getElementById("message").innerHTML = ('Click on restart!');
        }
      }

      function leftClick(line, column) {
        var arrayLine = new Array(1000).fill(0);
        var arrayColumn = new Array(1000).fill(0);
        var length = 0;
        arrayLine[length] = line;
        arrayColumn[length] = column;
        ++length;
        for (var i = 0; i < length; ++i) {
          var bombs = 0;
          if (table[arrayLine[i] - 1][arrayColumn[i] - 1] == '4') {
            ++bombs;
          } 
          if (table[arrayLine[i] - 1][arrayColumn[i]] == '4') {
            ++bombs;
          } 
          if (table[arrayLine[i] - 1][arrayColumn[i] + 1] == '4') {
            ++bombs;
          }
          if (table[arrayLine[i]][arrayColumn[i] + 1] == '4') {
            ++bombs;
          } 
          if (table[arrayLine[i] + 1][arrayColumn[i] + 1] == '4') {
            ++bombs;
          } 
          if (table[arrayLine[i] + 1][arrayColumn[i]] == '4') {
            ++bombs;
          } 
          if (table[arrayLine[i] + 1][arrayColumn[i] - 1] == '4') {
            ++bombs;
          } 
          if (table[arrayLine[i]][arrayColumn[i] - 1] == '4') {
            ++bombs;
          } 
          if (bombs > '0') {
            table[arrayLine[i]][arrayColumn[i]] = 1;
            document.getElementById(arrayLine[i] + " " + arrayColumn[i]).style.backgroundColor = '#66ffff';
            document.getElementById(arrayLine[i] + " " + arrayColumn[i]).innerHTML = (bombs);
          } else {
            if (table[arrayLine[i] - 1][arrayColumn[i]] == '0') {
              arrayLine[length] = arrayLine[i] - 1;
              arrayColumn[length] = arrayColumn[i];
              ++length;
            }
            if (table[arrayLine[i]][arrayColumn[i] + 1] == '0') {
              arrayLine[length] = arrayLine[i];
              arrayColumn[length] = arrayColumn[i] + 1;
              ++length;
            }
            if (table[arrayLine[i] + 1][arrayColumn[i]] == '0') {
              arrayLine[length] = arrayLine[i] + 1;
              arrayColumn[length] = arrayColumn[i];
              ++length;
            }
            if (table[arrayLine[i]][arrayColumn[i] - 1] == '0') {
              arrayLine[length] = arrayLine[i];
              arrayColumn[length] = arrayColumn[i] - 1;
              ++length;
            }
            if (table[arrayLine[i] - 1][arrayColumn[i] - 1] == '0') {
              arrayLine[length] = arrayLine[i] - 1;
              arrayColumn[length] = arrayColumn[i] - 1;
              ++length;
            }
            if (table[arrayLine[i] - 1][arrayColumn[i] + 1] == '0') {
              arrayLine[length] = arrayLine[i] - 1;
              arrayColumn[length] = arrayColumn[i] + 1;
              ++length;
            }
            if (table[arrayLine[i] + 1][arrayColumn[i] - 1] == '0') {
              arrayLine[length] = arrayLine[i] + 1;
              arrayColumn[length] = arrayColumn[i] - 1;
              ++length;
            }
            if (table[arrayLine[i] + 1][arrayColumn[i] + 1] == '0') {
              arrayLine[length] = arrayLine[i] + 1;
              arrayColumn[length] = arrayColumn[i] + 1;
              ++length;
            }
            table[arrayLine[i]][arrayColumn[i]] = 1;
            document.getElementById(arrayLine[i] + " " + arrayColumn[i]).innerHTML = ('');
            document.getElementById(arrayLine[i] + " " + arrayColumn[i]).style.backgroundColor = '#66ffff';
          }
          var check = 0;
          for (var x = 0; x < 15; ++x) {
            for (var y = 0; y < 15; ++y) {
              if (table[x][y] == '0') {
                x = 15;
                y = 15;
                check = 1;
              }
            }
          }
          if (check == '0') {
            ++gameStatus;
            document.getElementById("message").innerHTML = ('Congratulation! You win!');
          }
        }
      }

      function restart() {
        window.location.reload(true);
      }
    </script>
  </body>
</html>